<!DOCTYPE html>
<html>
<head>
    <title>EDO CTA</title>
    <style type="text/css">
        .watable .checkable {
            width:3%;
            text-align: center;
        }
        .watable .montos {
            text-align: right;
        }
        .watable .estrechar {
            width:10%;
        }
        .watable * {
          white-space: nowrap;
          font-size: 12px !important;
        }

        .watable.table {
          width: auto;
        }

        .watable p {
          margin: 0;
        }

        .watable th,
        .watable td {
          border-width: 1px !important;
        }

        .watable .glyphicon {
          margin: 0 0 0 2px;
          opacity: 0.5;
        }

        .watable span.filter {
          background-color: #999;
        }

        .watable .indeterminate {
          opacity: 0.4;
          -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=40)";
          filter: alpha(opacity=40);
        }

        .watable .columnpicker li,
        .watable .actions li {
          padding-left: 5px;
        }

        .watable .btn-toolbar {
          margin-bottom: -5px;
        }

        .watable .pagination {
          margin: 0;
        }

        .watable input[type=checkbox] {
          margin: 0;
          padding: 0;
        }

        .watable input[type=text].filter {
          margin: 0;
          padding: 0;
          box-shadow: none;
          border: none;
          width: 100%;
          float: left;
          background-color: transparent;
        }

        .watable .date-wrap {
          width: 100%;
          min-width: 115px;
        }

        .watable .dateWrap .add-on {
          margin: 0;
          padding: 0;
          background: none;
          border: none;
          float: right;
          cursor: pointer;
        }

        .watable .dropdown-menu {
          max-height: 100%;
          overflow: auto;
        }

        .watable .actions a {
          padding: 0;
          margin: 0;
        }

        /* Only for demo purposes */
        .watable .green {
          background: -moz-linear-gradient(left, rgba(255,255,255,0) 0%, rgba(0,140,37,0.38) 38%, rgba(0,140,37,1) 100%); /* FF3.6+ */
          background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(38%,rgba(0,140,37,0.38)), color-stop(100%,rgba(0,140,37,1))); /* Chrome,Safari4+ */
          background: -webkit-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(0,140,37,0.38) 38%,rgba(0,140,37,1) 100%); /* Chrome10+,Safari5.1+ */
          background: -o-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(0,140,37,0.38) 38%,rgba(0,140,37,1) 100%); /* Opera 11.10+ */
          background: -ms-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(0,140,37,0.38) 38%,rgba(0,140,37,1) 100%); /* IE10+ */
          background: linear-gradient(to right, rgba(255,255,255,0) 0%,rgba(0,140,37,0.38) 38%,rgba(0,140,37,1) 100%); /* W3C */
          filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00ffffff', endColorstr='#008c25',GradientType=1 ); /* IE6-9 */
        }

        .watable .yellow {
          background: -moz-linear-gradient(left, rgba(255,255,255,0) 0%, rgba(188,179,0,0.38) 38%, rgba(188,179,0,1) 100%); /* FF3.6+ */
          background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(38%,rgba(188,179,0,0.38)), color-stop(100%,rgba(188,179,0,1))); /* Chrome,Safari4+ */
          background: -webkit-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(188,179,0,0.38) 38%,rgba(188,179,0,1) 100%); /* Chrome10+,Safari5.1+ */
          background: -o-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(188,179,0,0.38) 38%,rgba(188,179,0,1) 100%); /* Opera 11.10+ */
          background: -ms-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(188,179,0,0.38) 38%,rgba(188,179,0,1) 100%); /* IE10+ */
          background: linear-gradient(to right, rgba(255,255,255,0) 0%,rgba(188,179,0,0.38) 38%,rgba(188,179,0,1) 100%); /* W3C */
          filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00ffffff', endColorstr='#bcb300',GradientType=1 ); /* IE6-9 */
        }

        .watable .red {
          background: -moz-linear-gradient(left, rgba(255,255,255,0) 0%, rgba(147,22,0,0.38) 38%, rgba(147,22,0,1) 100%); /* FF3.6+ */
          background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(38%,rgba(147,22,0,0.38)), color-stop(100%,rgba(147,22,0,1))); /* Chrome,Safari4+ */
          background: -webkit-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(147,22,0,0.38) 38%,rgba(147,22,0,1) 100%); /* Chrome10+,Safari5.1+ */
          background: -o-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(147,22,0,0.38) 38%,rgba(147,22,0,1) 100%); /* Opera 11.10+ */
          background: -ms-linear-gradient(left, rgba(255,255,255,0) 0%,rgba(147,22,0,0.38) 38%,rgba(147,22,0,1) 100%); /* IE10+ */
          background: linear-gradient(to right, rgba(255,255,255,0) 0%,rgba(147,22,0,0.38) 38%,rgba(147,22,0,1) 100%); /* W3C */
          filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00ffffff', endColorstr='#931600',GradientType=1 ); /* IE6-9 */
        }

        .watable .blue {
          background: -moz-linear-gradient(left,  rgba(255,255,255,0) 0%, rgba(0,127,206,0.38) 38%, rgba(0,127,206,1) 100%) !important; /* FF3.6+ */
          background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba(255,255,255,0)), color-stop(38%,rgba(0,127,206,0.38)), color-stop(100%,rgba(0,127,206,1))) !important; /* Chrome,Safari4+ */
          background: -webkit-linear-gradient(left,  rgba(255,255,255,0) 0%,rgba(0,127,206,0.38) 38%,rgba(0,127,206,1) 100%) !important; /* Chrome10+,Safari5.1+ */
          background: -o-linear-gradient(left,  rgba(255,255,255,0) 0%,rgba(0,127,206,0.38) 38%,rgba(0,127,206,1) 100%) !important; /* Opera 11.10+ */
          background: -ms-linear-gradient(left,  rgba(255,255,255,0) 0%,rgba(0,127,206,0.38) 38%,rgba(0,127,206,1) 100%) !important;/* IE10+ */
          background: linear-gradient(to right,  rgba(255,255,255,0) 0%,rgba(0,127,206,0.38) 38%,rgba(0,127,206,1) 100%) !important; /* W3C */
          filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#00ffffff', endColorstr='#007fce',GradientType=1 ) !important; /* IE6-9 */
        }

        .watable .gray {
          background-color: #d3d3d3 !important;
        }        
    </style>
</head>
<body>
    <div  align="right">
        <button type="button" class="btn btn-default" onclick="alert('Descarga documentos dummy.');" aria-label="Left Align">
            <span class="glyphicon glyphicon glyphicon-arrow-down" aria-hidden="true"></span>&nbsp;Descargar Documentos
        </button>
    </div>
    <div>
        <h2>Estado de Cuenta</h2>
    </div>
    <div id="example2" style="width:100%;">
    </div>
    <script type="text/javascript">
        $(document).ready( function() {
            var waTable = $('#example2').WATable({
            debug:false,
            dataBind: true,
            pageSize: 50,
            pageSizePadding: true,
            filter: true,
            sorting: true,
            sortEmptyLast:true,
            columnPicker: false,
            pageSizes: [1,5,8,12,200],
            hidePagerOnEmpty: true,
            checkboxes: true,
            checkAllToggle:true,
            preFill: true,
            types: {
                string: {
                    filterTooltip: "Giggedi..."
                },
                number: {
                    decimals: 2
                },
                bool: {
                },
                date: {
                  utc: true,
                  format: 'yyyy/MM/dd',
                  datePicker: true
                }
            },
           
            tableCreated: function(data) {
                console.log('table created');
                console.log(data);
            },
            rowClicked: function(data) {
                console.log('row clicked');
                console.log(data);
                if (data.column) {
                    data.event.preventDefault();
                    alert('You clicked column:' + data.column.column + ' with value:' + data.row[data.column.column]);
                }
            },
            columnClicked: function(data) {
              console.log('column clicked');
              console.log(data);
            },
            pageChanged: function(data) {
              console.log('page changed');
              console.log(data);
            },
            pageSizeChanged: function(data) {
              console.log('pagesize changed');
              console.log(data);
            }
        }).data('WATable');

        console.log("$> Consumir Servicio");
        var data = {};
        $.ajax({
                type:"GET",
                dataType : 'json',
                url: "http://localhost:3000/api/v1/reporte_estado_cuenta",
                success: function(data){
                waTable.setData(jsonConstructor(data));         
            }
        });

            //Get the data
            var allRows = waTable.getData(false);
            var checkedRows = waTable.getData(true);
            var filteredRows = waTable.getData(false, true);
            var renderedRows = waTable.getData(false, false, true);
            var pageSize = waTable.option("pageSize"); //Get option
            //Example event handler triggered by the custom refresh link above.
            $('#example2').on('click', '.refresh', function(e) {
                e.preventDefault();
                var data = generateSampleData(100);
                waTable.setData(data, true);
            });
            //Example event handler triggered by the custom export links above.
            $('#example2').on('click', '.export', function(e) {
                e.preventDefault();
                var elem = $(e.target);
                var data;
                if (elem.hasClass('all')) data = waTable.getData(false);
                else if (elem.hasClass('checked')) data = waTable.getData(true);
                else if (elem.hasClass('filtered')) data = waTable.getData(false, true);
                else if (elem.hasClass('rendered')) data = waTable.getData(false, false, true);
                console.log(data.rows.length + ' rows returned');
                console.log(data);
                alert(data.rows.length + ' rows returned.\nSee data in console.');
            });

        });           
   


function jsonConstructor(json) {
    var rows = [];
    var jsonObject = json.response;
    var sinicial = 0;
    var sfinal = 0;
    for (var i=0;i<jsonObject.totalRows;i++) {
    //for (var i=0;i<5;i++) {
        strDate = JSON.stringify(jsonObject.data[i].fecha);
        jsDate = new Date(strDate);
        var dia = jsDate.getDate();
        var mes = jsDate.getMonth();
        var ano = jsDate.getFullYear();
        var row = {};

        row.TipoDoc =   jsonObject.data[i].documento;
        row.Documentno =   jsonObject.data[i].documentno;
        row.Fecha = Date.UTC(ano, mes, dia);
        row.Cargo =  jsonObject.data[i].cargo;
        row.Abono =  jsonObject.data[i].abono;
        row.Inicial = sinicial;
        sfinal = sinicial + jsonObject.data[i].cargo - jsonObject.data[i].abono;
        row.Final = sfinal;
        sinicial = sfinal;

        row["row-checkable"] = true;
        row["row-checked"]   = false;
        row["row-cls"]       = "";

        rows.push(row);
    } 
    // Definir columnas
    var cols = {
        Documentno: {
            index: 1,
            type: "string",
            friendly: "No. Documento",
            format: "<a href='#' target='_blank'>{0}</a>",
            unique: true,
            sortOrder: "asc"
        },
        TipoDoc: {
            index: 2,
            type: "string",
            friendly: "Tipo Doc."
        },
        Fecha: {
            index: 3,
            type: "date",
            friendly: "Fecha"
        },
        Inicial: {
            index: 4,
            type: "number",
            friendly: "S. Inicial",
            cls: "montos",
            placeHolder: "",
            format: "$ {0}",
            decimals: 2
        },
         Cargo: {
            index: 5,
            type: "number",
            friendly: "Cargo",
            cls: "montos",
            placeHolder: "",
            format: "$ {0}",
            decimals: 2
        },
        Abono: {
            index: 6,
            type: "number",
            friendly: "Abono",
            cls: "montos",
            placeHolder: "",
            format: "$ {0}",
            decimals: 2
        },
        Final: {
            index: 7,
            type: "number",
            friendly: "S. Final",
            cls: "montos",
            placeHolder: "",
            format: "$ {0}",
            decimals: 2
        }
    };
    // Contruir el json de datos
    var data = {
                cols: cols,
                rows: rows,
                otherStuff: {
                    thatIMight: 1,
                    needLater: true
                }
            };
    return data;
}
</script>
</body>
</html>